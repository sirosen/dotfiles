#!/bin/bash
set -e

cd "$(dirname "$0")"

# map toolnames (executable names) to their requirement lists
declare -A toolmap
toolmap[pylint]="pylint"

mkdir -p .managed-venvs
pushd .managed-venvs

# create or update each venv
for toolname in "${!toolmap[@]}"; do
  envname="${toolname}-env"
  if [ ! -d "$envname" ]; then
    python -m venv "$envname"
  fi
  # shellcheck disable=SC1090
  . "$envname/bin/activate"
  pip install -U "${toolmap[$toolname]}"
  deactivate
done

popd

# create or update symlinks
for toolname in "${!toolmap[@]}"; do
  envname="${toolname}-env"
  if [ ! -f "$toolname" ]; then
    ln -s .managed-venvs/$envname/bin/$toolname $toolname
  fi
done
